# 内存层级设计
---
layout: mypost
title: 计算机体系结构备忘
categories: [备忘，在写了]
---

## 概览
### 三类 cache 缺失情况
- 必要型：第一次访问是一定不可能命中的，因为至少访问一次之后对应的块才可能存入 cache 
- 容量型：之前存入 cache 的块可能因为 cache 容量不足而被清除了
- 冲突型：多个块可能映射到了同一块存 cache 的地方，之前存好的块可能会被后存入的块顶掉

总的来看，必要型缺失与容量无关，容量型缺失随 cache 容量的增大而减小，冲突型缺失随 cache 相联路数增大而减小（八路相联、四路相联等等）

一般用平均内存访问时间来度量性能，平均内存访问时间=命中时间+缺失率 x 缺失代价。命中时间是指查询 cache 的时间，缺失代价是指把内存中的块换到 cache 的时间

### 六种应对方法
- 增大 cache 块大小，这种方法能减少必要型型缺失，但是会提高缺失代价（一次要搬的块大了）
- 增大 cache 总容量，此方法能减少容量型缺失，但是可能导致查 cache 的时间变长，也可能导致耗能增加
- 增加相联的路数以减小冲突型缺失，但是可能会增加功耗
- 利用多级 cache 缺少缺失代价，比如 L1, L2 cache，只要保证容量小的那个 cache 能跟上 cpu 的速度，容量大的 cache 能让大多数访存命中即可。此方法比设置一个巨大 cache 省电
- 让读操作比写操作优先，此做法一般是用来配合写缓存的。在写后读的情况下，要读数据就可以直接从写缓存里读出来，而不是等真的写完了然后再读
- 
